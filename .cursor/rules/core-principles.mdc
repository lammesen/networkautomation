---
description: Core principles and architecture
globs: 
alwaysApply: true
---

# Core Principles

- **ALWAYS use sequentialThinking** (`mcp__sequential-thinking__sequentialthinking`) for ALL tasks
- **Tenant scoping is MANDATORY** - Every customer-related queryset MUST be scoped
- **RBAC enforcement** - Use `RolePermission` on all viewsets
- **Type hints required** - All functions must have type annotations (mypy strict)
- **Follow existing patterns** - Always examine existing code before writing new

## Architecture

- **Backend**: Django 5 + DRF + Channels + Celery (Python 3.11)
- **Frontend**: HTMX (95%) + React Islands (5%) + shadcn/ui + Tailwind
- **Multi-tenant**: All queries must be customer-scoped
- **Database**: PostgreSQL (production) / SQLite (dev default)
- **Message Broker**: Redis (Celery + Channels)

## Django Apps

- `api` - REST API endpoints, serializers, permissions, WebSocket consumers
- `compliance` - Compliance policies and results
- `config_mgmt` - Configuration snapshots and deployment
- `core` - Celery, crypto, middleware, signals, SSH manager
- `customers` - Multi-tenant customer model and IP ranges
- `devices` - Network device inventory and credentials
- `jobs` - Job tracking and Celery tasks
- `networkops` - Network operations support
- `ui` - HTMX view handlers
- `users` - User model, authentication, API keys
