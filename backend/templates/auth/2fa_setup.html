{% extends "base.html" %}
{% block title %}Setup Two-Factor Authentication - webnet{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
  <div class="mb-8">
    <h1 class="text-3xl font-bold tracking-tight">Setup Two-Factor Authentication</h1>
    <p class="text-muted-foreground mt-2">Secure your account with TOTP authentication</p>
  </div>

  <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
    <div class="p-6">
      {% if error %}
      <div class="mb-4 flex items-center gap-3 rounded-lg border border-destructive/50 bg-destructive/10 p-4 text-sm text-destructive">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>{{ error }}</span>
      </div>
      {% endif %}

      <div class="space-y-6">
        <div>
          <h2 class="text-lg font-semibold mb-2">Step 1: Scan QR Code</h2>
          <p class="text-sm text-muted-foreground mb-4">
            Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)
          </p>
          <div class="flex justify-center p-6 bg-white rounded-lg">
            <img src="{% url '2fa-qrcode' %}" alt="2FA QR Code" class="w-64 h-64" />
          </div>
        </div>

        <div>
          <h2 class="text-lg font-semibold mb-2">Manual Entry</h2>
          <p class="text-sm text-muted-foreground mb-2">
            If you can't scan the QR code, enter this key manually:
          </p>
          <div class="p-3 bg-muted rounded-md font-mono text-sm break-all">
            {{ secret }}
          </div>
        </div>

        <div>
          <h2 class="text-lg font-semibold mb-2">Step 2: Verify</h2>
          <p class="text-sm text-muted-foreground mb-4">
            Enter the 6-digit code from your authenticator app to complete setup
          </p>
          
          <form method="post" class="space-y-4">
            {% csrf_token %}

            <div class="space-y-2">
              <label class="text-sm font-medium leading-none" for="id_token">Verification Code</label>
              <input 
                type="text" 
                name="token" 
                id="id_token" 
                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" 
                placeholder="Enter 6-digit code" 
                maxlength="6"
                pattern="[0-9]{6}"
                autofocus 
                required 
              />
            </div>

            <div class="flex gap-3">
              <button type="submit" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Complete Setup
              </button>
              <a href="{% url 'dashboard' %}" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
                Cancel
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-6 p-4 bg-muted rounded-lg">
    <h3 class="font-semibold text-sm mb-2 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      Recommended Authenticator Apps
    </h3>
    <ul class="text-sm text-muted-foreground space-y-1">
      <li>• Google Authenticator (iOS, Android)</li>
      <li>• Authy (iOS, Android, Desktop)</li>
      <li>• Microsoft Authenticator (iOS, Android)</li>
      <li>• 1Password (Cross-platform)</li>
    </ul>
  </div>
</div>
{% endblock content %}
