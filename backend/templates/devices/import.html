{% extends "base.html" %}
{% block title %}Import Devices - webnet{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav class="flex mb-4" aria-label="Breadcrumb">
  <ol class="inline-flex items-center space-x-1 md:space-x-2 text-sm">
    <li class="inline-flex items-center">
      <a href="/devices/" class="text-muted-foreground hover:text-foreground">Devices</a>
    </li>
    <li class="flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mx-1 text-muted-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <span class="font-medium">Import CSV</span>
    </li>
  </ol>
</nav>

<div class="max-w-2xl">
  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold tracking-tight">Import Devices from CSV</h1>
    <p class="text-muted-foreground">Bulk import devices using a CSV file</p>
  </div>

  <!-- Info Alert -->
  <div class="rounded-lg border border-primary/20 bg-primary/5 p-4 mb-6">
    <div class="flex gap-3">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="h-5 w-5 text-primary shrink-0 mt-0.5">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" stroke="currentColor" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <div>
        <h3 class="font-semibold text-sm">CSV Format</h3>
        <p class="text-sm text-muted-foreground mt-1">Required columns: <code class="rounded bg-muted px-1 py-0.5 text-xs font-mono">hostname, mgmt_ip, vendor, platform, credential, role, site, tags</code></p>
      </div>
    </div>
  </div>

  <!-- Form Card -->
  <div class="rounded-lg border bg-card p-6">
    <form method="post" enctype="multipart/form-data" class="space-y-4">
      {% csrf_token %}

      <div class="space-y-2">
        <label for="customer" class="text-sm font-medium leading-none">
          Customer <span class="text-destructive">*</span>
        </label>
        <div data-island="FormSelect" data-props='{"name":"customer","placeholder":"Select a customer","options":[{% for c in customers %}{"value":"{{ c.id }}","label":"{{ c.name|escapejs }}"}{% if not forloop.last %},{% endif %}{% endfor %}]}'></div>
        <input type="hidden" name="customer" id="customer" required />
      </div>

      <div class="space-y-2">
        <label for="file" class="text-sm font-medium leading-none">
          CSV File <span class="text-destructive">*</span>
        </label>
        <input type="file" name="file" id="file" accept=".csv" 
               class="flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" 
               required />
        <p class="text-xs text-muted-foreground">Only .csv files are accepted</p>
      </div>

      {% if credentials %}
      <div class="space-y-2">
        <label class="text-sm font-medium leading-none">Available Credentials</label>
        <div class="flex flex-wrap gap-2">
          {% for cred in credentials %}
            <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold">{{ cred.customer.name }}:{{ cred.name }}</span>
          {% empty %}
            <span class="text-muted-foreground text-sm">No credentials available</span>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <div class="border-t pt-4 mt-6">
        <div class="flex justify-end gap-2">
          <a href="/devices/" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring h-9 px-4 py-2 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground">
            Cancel
          </a>
          <button type="submit" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring h-9 px-4 py-2 bg-primary text-primary-foreground shadow hover:bg-primary/90">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
            Import Devices
          </button>
        </div>
      </div>
    </form>

    {% if summary %}
    <div class="border-t mt-6 pt-6">
      <h3 class="font-semibold mb-3">Import Results</h3>
      <div class="rounded-lg border {% if summary.errors %}border-warning/20 bg-warning/5{% else %}border-success/20 bg-success/5{% endif %} p-4">
        <div class="flex gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 {% if summary.errors %}text-warning{% else %}text-success{% endif %} shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            {% if summary.errors %}
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            {% else %}
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            {% endif %}
          </svg>
          <div>
            <h4 class="font-semibold text-sm">Import Summary</h4>
            <div class="flex gap-3 text-sm mt-2">
              <span class="inline-flex items-center rounded-full bg-success/10 px-2.5 py-0.5 text-xs font-semibold text-success">Created: {{ summary.created }}</span>
              <span class="inline-flex items-center rounded-full bg-primary/10 px-2.5 py-0.5 text-xs font-semibold text-primary">Updated: {{ summary.updated }}</span>
              <span class="inline-flex items-center rounded-full bg-warning/10 px-2.5 py-0.5 text-xs font-semibold text-warning">Skipped: {{ summary.skipped }}</span>
            </div>
            {% if summary.errors %}
              <ul class="list-disc list-inside text-sm mt-3 text-destructive space-y-1">
                {% for e in summary.errors %}<li>{{ e }}</li>{% endfor %}
              </ul>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
